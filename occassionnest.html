<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OccasionNest — Frontend Prototype</title>
  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root{
      --accent:#b56fb1;
      --muted:#f6f2fb;
    }
    body{font-family:Inter,system-ui,Arial, sans-serif;background:linear-gradient(180deg,#fff 0%,var(--muted) 100%);}
    .hero{background:linear-gradient(90deg, rgba(181,111,177,0.08), rgba(242,230,248,0.6)); padding:3.5rem 0}
    .event-card{cursor:pointer; transition:transform .18s ease, box-shadow .18s ease}
    .event-card:hover{transform:translateY(-6px); box-shadow:0 10px 30px rgba(16,24,40,.08)}
    .theme-mehndi{background:#fff7e6}
    .theme-nikkah{background:#f6fbff}
    .item-image{height:160px;object-fit:cover}
    .badge-theme{background:linear-gradient(90deg,#ffd2d2,#f6f2fb);color:#4b2b3a}
    footer{padding:2rem 0}
    .sticky-top-shadow{box-shadow:0 2px 6px rgba(0,0,0,.06)}
    .small-muted{font-size:.9rem;color:#6b7280}
  </style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top sticky-top-shadow">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center gap-2" href="#">
      <i class="fa-solid fa-cake-candles" style="color:var(--accent)"></i>
      <span class="fw-bold">OccasionNest</span>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav ms-auto me-3 mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link" href="#events">Events</a></li>
        <li class="nav-item"><a class="nav-link" href="#planner">Plan Your Event</a></li>
        <li class="nav-item"><a class="nav-link" href="#contact">Contact</a></li>
      </ul>

      <div class="d-flex gap-2">
        <button class="btn btn-outline-primary" id="wishlistBtn" data-bs-toggle="offcanvas" data-bs-target="#offcanvasWishlist"><i class="fa-regular fa-heart"></i> <span id="wishlistCount" class="badge bg-danger ms-1">0</span></button>
        <button class="btn btn-primary" id="cartBtn" data-bs-toggle="offcanvas" data-bs-target="#offcanvasCart"><i class="fa-solid fa-cart-shopping"></i> <span id="cartCount" class="badge bg-white text-dark ms-1">0</span></button>
        <button class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#authModal">Login / Signup</button>
      </div>
    </div>
  </div>
</nav>

<!-- HERO -->
<section class="hero">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-7">
        <h1 class="display-5">OccasionNest — All Your Event Needs in One Place</h1>
        <p class="lead small-muted">Explore themed decorations, props, and accessories for weddings, birthdays, and cultural events. Rent, buy, customize — all from home.</p>

        <div class="mt-3 d-flex gap-2">
          <a class="btn btn-lg btn-primary" href="#events">Explore Events</a>
          <a class="btn btn-lg btn-outline-secondary" href="#planner">Plan Your Event</a>
        </div>

        <div class="row mt-4 g-3">
          <div class="col-6 col-md-4">
            <div class="p-3 bg-white rounded-3">
              <i class="fa-solid fa-truck-fast fa-2x" style="color:var(--accent)"></i>
              <div class="small-muted">Flexible delivery & returns</div>
            </div>
          </div>
          <div class="col-6 col-md-4">
            <div class="p-3 bg-white rounded-3">
              <i class="fa-solid fa-hand-holding-dollar fa-2x" style="color:var(--accent)"></i>
              <div class="small-muted">Rent or own — your choice</div>
            </div>
          </div>
          <div class="col-6 col-md-4">
            <div class="p-3 bg-white rounded-3">
              <i class="fa-solid fa-users fa-2x" style="color:var(--accent)"></i>
              <div class="small-muted">Support local vendors (future)</div>
            </div>
          </div>
        </div>

      </div>
      <div class="col-lg-5 d-none d-lg-block">
        <img src="https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=123456" class="img-fluid rounded-3 shadow-sm" alt="hero">
      </div>
    </div>
  </div>
</section>

<!-- EVENTS GRID -->
<section id="events" class="py-5">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h3 class="mb-0">Event Categories</h3>
      <input id="searchInput" class="form-control w-25" placeholder="Search events...">
    </div>

    <div class="row g-3" id="eventsGrid"></div>
  </div>
</section>

<!-- DYNAMIC ITEMS AREA (Will show items after clicking an event) -->
<section id="itemsSection" class="py-4 d-none">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 id="itemsTitle">Items</h4>
      <div>
        <select id="filterType" class="form-select d-inline-block w-auto me-2">
          <option value="all">All</option>
          <option value="rent">Rent</option>
          <option value="purchase">Purchase</option>
        </select>
        <select id="filterPrice" class="form-select d-inline-block w-auto">
          <option value="any">Any Price</option>
          <option value="0-20">Under $20</option>
          <option value="20-100">$20 - $100</option>
          <option value="100-99999">Above $100</option>
        </select>
      </div>
    </div>

    <div id="itemsGrid" class="row g-3"></div>

    <div class="mt-4">
      <button class="btn btn-outline-secondary" id="backToEvents">Back to Events</button>
    </div>
  </div>
</section>

<!-- PLANNER -->
<section id="planner" class="py-5 bg-white">
  <div class="container">
    <h3>Plan Your Event</h3>
    <p class="small-muted">Tell us a few details and we’ll suggest themes and items.</p>
    <form id="plannerForm" class="row g-3">
      <div class="col-md-4">
        <label class="form-label">Event Type</label>
        <select class="form-select" id="planType">
          <option>Mehndi</option>
          <option>Dholki</option>
          <option>Nikkah</option>
          <option>Birthday</option>
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label">Guest Count</label>
        <input class="form-control" id="planGuests" type="number" placeholder="e.g. 50">
      </div>
      <div class="col-md-4">
        <label class="form-label">Budget (USD)</label>
        <input class="form-control" id="planBudget" type="number" placeholder="e.g. 200">
      </div>
      <div class="col-12">
        <button class="btn btn-primary">Get Suggestions</button>
      </div>
    </form>
  </div>
</section>

<!-- FOOTER -->
<footer class="bg-white mt-5">
  <div class="container d-flex justify-content-between align-items-center">
    <div>
      <strong>OccasionNest</strong>
      <div class="small-muted">A demo project by BC220417136 (Jannat)</div>
    </div>
    <div class="small-muted">© <span id="year"></span> All Rights Reserved</div>
  </div>
</footer>


<!-- OFFCANVAS WISHLIST -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasWishlist">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title">Wishlist</h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body" id="wishlistBody">
    <!-- wishlist items injected by JS -->
  </div>
</div>

<!-- OFFCANVAS CART -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasCart">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title">Cart</h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <div id="cartBody"></div>
    <div class="mt-3 d-flex justify-content-between align-items-center">
      <div class="fw-bold">Total: $<span id="cartTotal">0</span></div>
      <div>
        <button class="btn btn-outline-secondary" id="continueShopping">Continue</button>
        <button class="btn btn-primary" id="checkoutBtn">Checkout</button>
      </div>
    </div>
  </div>
</div>

<!-- AUTH MODAL (Login / Signup) -->
<div class="modal fade" id="authModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Login / Signup</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <ul class="nav nav-tabs" id="authTabs">
          <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#loginTab">Login</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#signupTab">Signup</button></li>
        </ul>
        <div class="tab-content mt-3">
          <div class="tab-pane fade show active" id="loginTab">
            <form id="loginForm">
              <div class="mb-3"><input class="form-control" id="loginEmail" placeholder="Email"></div>
              <div class="mb-3"><input class="form-control" id="loginPassword" type="password" placeholder="Password"></div>
              <button class="btn btn-primary w-100">Login</button>
            </form>
          </div>
          <div class="tab-pane fade" id="signupTab">
            <form id="signupForm">
              <div class="mb-3"><input class="form-control" id="signupName" placeholder="Full name"></div>
              <div class="mb-3"><input class="form-control" id="signupEmail" placeholder="Email"></div>
              <div class="mb-3"><input class="form-control" id="signupPassword" type="password" placeholder="Password"></div>
              <button class="btn btn-outline-primary w-100">Create account</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ITEM DETAIL / CUSTOMIZE MODAL -->
<div class="modal fade" id="itemModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body" id="itemModalBody"></div>
    </div>
  </div>
</div>


<!-- SCRIPTS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// ---------- Sample data (would normally come from backend) ----------
const EVENTS = [
  {id:'mehndi',name:'Mehndi',desc:'Colorful henna celebration',theme:'theme-mehndi',img:'https://images.unsplash.com/photo-1520975698513-0f6e7e7a0d15?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=abc'},
  {id:'dholki',name:'Dholki',desc:'Pre-wedding music night',theme:'',img:'https://images.unsplash.com/photo-1505577058444-a3dab6a5e5c1?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=def'},
  {id:'nikkah',name:'Nikkah',desc:'Sacred wedding ceremony',theme:'theme-nikkah',img:'https://images.unsplash.com/photo-1546539788-cc36a21e56f0?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=ghi'},
  {id:'birthday',name:'Birthday',desc:'Balloons, cakes & fun',theme:'',img:'https://images.unsplash.com/photo-1513104890138-7c749659a591?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=jkl'},
  {id:'walima',name:'Walima',desc:'Reception elegance',theme:'',img:'https://images.unsplash.com/photo-1519150268069-c094cfc0b3c0?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=mno'}
];

const ITEMS = {
  mehndi:[
    {id:'m1',name:'Mehndi Plate Set',price:12,type:'purchase',img:'https://images.unsplash.com/photo-1603113045129-0d9f7d96b3f1?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=111',desc:'Decorated plates for mehndi rituals.'},
    {id:'m2',name:'Mehndi Cone Props',price:8,type:'purchase',img:'https://images.unsplash.com/photo-1520975698513-0f6e7e7a0d15?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=222',desc:'Photo props and cones for henna.'},
    {id:'m3',name:'Haldi Bowl (Rental)',price:30,type:'rent',img:'https://images.unsplash.com/photo-1542736667-069246bdbc27?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=333',desc:'Traditional haldi bowl for ceremony.'}
  ],
  dholki:[
    {id:'d1',name:'Dholki Drum Decor',price:20,type:'purchase',img:'https://images.unsplash.com/photo-1549271263-7fe9a13a9cf5?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=444',desc:'Colorful dholki drum decorations.'},
    {id:'d2',name:'Dholki Backdrop (Rental)',price:120,type:'rent',img:'https://images.unsplash.com/photo-1520697222861-8d6b2a6b9d25?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=555',desc:'Large backdrop for dholki stage.'}
  ],
  nikkah:[
    {id:'n1',name:'Nikkah Signing Booklet',price:22,type:'purchase',img:'https://images.unsplash.com/photo-1529336953129-1f1be5f1c4b5?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=666',desc:'Elegant signing booklets.'},
    {id:'n2',name:'Bride Entry Chaddar (Rental)',price:80,type:'rent',img:'https://images.unsplash.com/photo-1520975698513-0f6e7e7a0d15?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=777',desc:'Decorative fabric for entry.'}
  ],
  birthday:[
    {id:'b1',name:'Custom Cake Topper',price:15,type:'purchase',img:'https://images.unsplash.com/photo-1532634896-26909d0d3a81?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=888',desc:'Personalized birthday cake toppers.'},
    {id:'b2',name:'Balloon Garland (Rental)',price:60,type:'rent',img:'https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=999',desc:'Large balloon garland for parties.'}
  ],
  walima:[
    {id:'w1',name:'Return Gift Set',price:25,type:'purchase',img:'https://images.unsplash.com/photo-1518544881928-3b3b00e6f8b8?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=1010',desc:'Elegant return gifts.'}
  ]
};

// ---------- Utilities for local cart/wishlist ----------
const store = {
  get(key){try{return JSON.parse(localStorage.getItem(key))||[];}catch(e){return [];}},
  set(key,val){localStorage.setItem(key,JSON.stringify(val));}
}

// ---------- Rendering functions ----------
function renderEvents(filter=''){
  const grid = document.getElementById('eventsGrid'); grid.innerHTML='';
  const q = filter.trim().toLowerCase();
  EVENTS.filter(e=>e.name.toLowerCase().includes(q)||e.desc.toLowerCase().includes(q)).forEach(ev=>{
    const col = document.createElement('div'); col.className='col-12 col-sm-6 col-md-4 col-lg-3';
    col.innerHTML = `
      <div class="card event-card h-100" data-id="${ev.id}">
        <img src="${ev.img}" class="card-img-top item-image" alt="${ev.name}">
        <div class="card-body">
          <h5 class="card-title">${ev.name}</h5>
          <p class="card-text small-muted">${ev.desc}</p>
          <div class="d-flex justify-content-between align-items-center">
            <button class="btn btn-sm btn-outline-primary viewEvent" data-id="${ev.id}">Open</button>
            <span class="badge badge-theme small">Explore</span>
          </div>
        </div>
      </div>`;
    grid.appendChild(col);
  })
}

function showItemsForEvent(eventId){
  const items = ITEMS[eventId]||[];
  document.getElementById('itemsSection').classList.remove('d-none');
  document.getElementById('itemsTitle').textContent = (EVENTS.find(e=>e.id===eventId)||{}).name + ' — Items';
  const grid = document.getElementById('itemsGrid'); grid.innerHTML='';
  items.forEach(it=>{
    const col = document.createElement('div'); col.className='col-12 col-md-6 col-lg-4';
    col.innerHTML = `
      <div class="card h-100">
        <img src="${it.img}" class="card-img-top item-image" alt="${it.name}">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">${it.name}</h5>
          <p class="small-muted mb-2">${it.desc}</p>
          <div class="mt-auto d-flex justify-content-between align-items-center">
            <div>
              <div class="fw-bold">$${it.price}</div>
              <div class="small-muted">${it.type}</div>
            </div>
            <div class="d-flex flex-column gap-2">
              <button class="btn btn-sm btn-outline-secondary btn-sm viewItem" data-id="${it.id}" data-event="${eventId}">View</button>
              <div class="d-flex gap-1">
                <button class="btn btn-sm btn-outline-danger addWishlist" data-id="${it.id}" data-event="${eventId}"><i class="fa-regular fa-heart"></i></button>
                <button class="btn btn-sm btn-primary addCart" data-id="${it.id}" data-event="${eventId}"><i class="fa-solid fa-cart-plus"></i></button>
              </div>
            </div>
          </div>
        </div>
      </div>`;
    grid.appendChild(col);
  })
}

function renderWishlist(){
  const list = store.get('wishlist');
  const body = document.getElementById('wishlistBody'); body.innerHTML='';
  if(list.length===0){body.innerHTML='<div class="small-muted">No items in wishlist.</div>';return}
  list.forEach(w=>{
    const ev = w.event; const it = (ITEMS[ev]||[]).find(x=>x.id===w.id);
    if(!it) return;
    const node = document.createElement('div'); node.className='d-flex gap-2 align-items-center mb-2';
    node.innerHTML = `<img src="${it.img}" style="width:64px;height:64px;object-fit:cover;border-radius:.4rem"><div class="flex-grow-1"><div>${it.name}</div><div class="small-muted">$${it.price}</div></div><div><button class="btn btn-sm btn-primary moveToCart" data-id="${it.id}" data-event="${ev}">Move to cart</button></div>`;
    body.appendChild(node);
  })
}

function renderCart(){
  const cart = store.get('cart');
  const body = document.getElementById('cartBody'); body.innerHTML='';
  if(cart.length===0){body.innerHTML='<div class="small-muted">Your cart is empty.</div>';document.getElementById('cartTotal').textContent='0';return}
  let total = 0;
  cart.forEach(ci=>{
    const it = (ITEMS[ci.event]||[]).find(x=>x.id===ci.id); if(!it) return;
    total += it.price * (ci.qty||1);
    const node = document.createElement('div'); node.className='d-flex gap-2 align-items-center mb-2';
    node.innerHTML = `<img src="${it.img}" style="width:64px;height:64px;object-fit:cover;border-radius:.4rem"><div class="flex-grow-1"><div>${it.name}</div><div class="small-muted">$${it.price} x <input class="form-control form-control-sm cartQty" style="width:60px;display:inline-block" data-id="${it.id}" data-event="${ci.event}" value="${ci.qty||1}"></div></div><div><button class="btn btn-sm btn-danger removeCart" data-id="${it.id}" data-event="${ci.event}">Remove</button></div>`;
    body.appendChild(node);
  })
  document.getElementById('cartTotal').textContent = total.toFixed(2);
}

// ---------- Events binding ----------
function attachGlobalListeners(){
  document.getElementById('searchInput').addEventListener('input', e=>renderEvents(e.target.value));
  document.getElementById('backToEvents').addEventListener('click', ()=>{
    document.getElementById('itemsSection').classList.add('d-none');
  });

  document.addEventListener('click', e=>{
    if(e.target.closest('.viewEvent')){
      const id = e.target.closest('.viewEvent').dataset.id; showItemsForEvent(id);
    }
    if(e.target.closest('.viewItem')){
      const id = e.target.closest('.viewItem').dataset.id; const ev = e.target.closest('.viewItem').dataset.event; openItemModal(ev,id);
    }
    if(e.target.closest('.addWishlist')){
      const id = e.target.closest('.addWishlist').dataset.id; const ev = e.target.closest('.addWishlist').dataset.event; addToWishlist(ev,id);
    }
    if(e.target.closest('.addCart')){
      const id = e.target.closest('.addCart').dataset.id; const ev = e.target.closest('.addCart').dataset.event; addToCart(ev,id);
    }
    if(e.target.closest('.moveToCart')){
      const id = e.target.closest('.moveToCart').dataset.id; const ev = e.target.closest('.moveToCart').dataset.event; moveWishlistToCart(ev,id);
    }
    if(e.target.closest('.removeCart')){
      const id = e.target.closest('.removeCart').dataset.id; const ev = e.target.closest('.removeCart').dataset.event; removeFromCart(ev,id);
    }
  });

  // Quantity change in cart
  document.getElementById('cartBody').addEventListener('change', e=>{
    if(e.target.classList.contains('cartQty')){
      const id = e.target.dataset.id; const ev = e.target.dataset.event; const qty = parseInt(e.target.value)||1; updateCartQty(ev,id,qty);
    }
  });

  document.getElementById('checkoutBtn').addEventListener('click', ()=>{
    // Simple checkout mock: show confirm and clear cart
    const cart = store.get('cart'); if(cart.length===0){alert('Cart is empty');return}
    const orderId = 'ON-'+Math.random().toString(36).slice(2,9).toUpperCase();
    alert('Payment successful! Order ID: '+orderId);
    store.set('cart',[]); renderCart(); updateCounts();
    var offcanvas = bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasCart'));
    if(offcanvas) offcanvas.hide();
  });

  document.getElementById('plannerForm').addEventListener('submit', e=>{
    e.preventDefault(); const t=document.getElementById('planType').value; const b=document.getElementById('planBudget').value; const g=document.getElementById('planGuests').value; alert(`Suggested theme for ${t} with $${b} budget and ${g} guests:\n - Choose 3 decor items \n - 1 backdrop (rental) \n - 10 return gifts`)
  });

  document.getElementById('continueShopping').addEventListener('click', ()=>{var off=bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasCart')); if(off) off.hide();})

  // Simple auth forms (local only)
  document.getElementById('signupForm').addEventListener('submit', e=>{e.preventDefault();alert('Account created (demo). You are now logged in.'); var md=bootstrap.Modal.getInstance(document.getElementById('authModal')); if(md) md.hide();});
  document.getElementById('loginForm').addEventListener('submit', e=>{e.preventDefault();alert('Logged in (demo).'); var md=bootstrap.Modal.getInstance(document.getElementById('authModal')); if(md) md.hide();});
}

// ---------- Cart / Wishlist logic ----------
function addToWishlist(eventId,itemId){
  const list = store.get('wishlist');
  if(list.find(x=>x.id===itemId && x.event===eventId)) return alert('Already in wishlist');
  list.push({event:eventId,id:itemId}); store.set('wishlist',list); renderWishlist(); updateCounts();}

function addToCart(eventId,itemId,qty=1){
  const cart = store.get('cart');
  const existing = cart.find(x=>x.id===itemId && x.event===eventId);
  if(existing){ existing.qty = (existing.qty||1) + qty; }
  else cart.push({event:eventId,id:itemId,qty:qty});
  store.set('cart',cart); renderCart(); updateCounts(); alert('Added to cart');
}

function moveWishlistToCart(eventId,itemId){
  let list = store.get('wishlist'); list = list.filter(x=>!(x.id===itemId && x.event===eventId)); store.set('wishlist',list);
  addToCart(eventId,itemId); renderWishlist();
}

function removeFromCart(eventId,itemId){
  let cart = store.get('cart'); cart = cart.filter(x=>!(x.id===itemId && x.event===eventId)); store.set('cart',cart); renderCart(); updateCounts();
}

function updateCartQty(eventId,itemId,qty){
  const cart = store.get('cart'); const it = cart.find(x=>x.id===itemId && x.event===eventId); if(!it) return; it.qty = qty; store.set('cart',cart); renderCart(); updateCounts();
}

function updateCounts(){
  document.getElementById('wishlistCount').textContent = store.get('wishlist').length;
  document.getElementById('cartCount').textContent = store.get('cart').length;
}

// ---------- Item modal (detail + customize) ----------
function openItemModal(eventId,itemId){
  const it = (ITEMS[eventId]||[]).find(x=>x.id===itemId); if(!it) return;
  const body = document.getElementById('itemModalBody');
  body.innerHTML = `
    <div class="row g-3">
      <div class="col-md-6"><img src="${it.img}" class="img-fluid rounded" alt="${it.name}"></div>
      <div class="col-md-6">
        <h4>${it.name}</h4>
        <div class="small-muted">${it.type} • $${it.price}</div>
        <p class="mt-2">${it.desc}</p>
        <div class="mb-3">
          <label class="form-label">Choose Action</label>
          <div class="d-flex gap-2">
            <button class="btn btn-outline-primary" id="modalAddWishlist">Add to wishlist</button>
            <button class="btn btn-primary" id="modalAddCart">Add to cart</button>
            <button class="btn btn-outline-secondary" id="modalCustomize">Customize</button>
          </div>
        </div>
        <div id="customizeArea" class="d-none">
          <div class="mb-2"><input class="form-control" id="custText" placeholder="Text (e.g. name)"></div>
          <div class="mb-2"><input type="color" id="custColor" class="form-control form-control-color" value="#ffffff"></div>
          <div><button class="btn btn-success" id="saveCustomization">Save customization & add to cart</button></div>
        </div>
      </div>
    </div>`;

  // attach handlers
  setTimeout(()=>{
    document.getElementById('modalAddWishlist').addEventListener('click', ()=>{addToWishlist(eventId,itemId); var md=bootstrap.Modal.getInstance(document.getElementById('itemModal')); if(md) md.hide();});
    document.getElementById('modalAddCart').addEventListener('click', ()=>{addToCart(eventId,itemId); var md=bootstrap.Modal.getInstance(document.getElementById('itemModal')); if(md) md.hide();});
    document.getElementById('modalCustomize').addEventListener('click', ()=>{document.getElementById('customizeArea').classList.toggle('d-none');});
    document.getElementById('saveCustomization')?.addEventListener('click', ()=>{const text=document.getElementById('custText').value; const color=document.getElementById('custColor').value; addToCart(eventId,itemId,1); alert('Customization saved: '+text+' '+color); var md=bootstrap.Modal.getInstance(document.getElementById('itemModal')); if(md) md.hide();});
  },50);

  var modal = new bootstrap.Modal(document.getElementById('itemModal'));
  modal.show();
}

// ---------- Init ----------
(function init(){
  renderEvents(); attachGlobalListeners(); renderWishlist(); renderCart(); updateCounts(); document.getElementById('year').textContent=new Date().getFullYear();
})();

</script>
</body>
</html>
